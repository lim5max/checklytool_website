# Быстрый старт для тестирования платежей

## Шаг 1: Выполните миграции в Supabase

1. Откройте Supabase Dashboard → SQL Editor
2. Выполните файлы по порядку:

### Миграция 1: Создание таблицы payment_orders
Скопируйте содержимое файла `/supabase/migrations/001_create_payment_orders.sql` и выполните.

### Миграция 2: Обновление существующих пользователей
Скопируйте содержимое файла `/supabase/migrations/002_update_existing_users_with_free_plan.sql` и выполните.

## Шаг 2: Настройте переменные окружения

Создайте файл `.env.local`:

```bash
# Скопируйте все переменные из .env.example
# Обязательно добавьте эти для платежей:

TBANK_TERMINAL_KEY=1757689436544
TBANK_PASSWORD=0SapHdSKrEQRQCN7
TBANK_TEST_TERMINAL_KEY=1757689436304DEMO
TBANK_TEST_PASSWORD=WFgr%waXvmeK3n%j
TBANK_MODE=test
```

## Шаг 3: Перезапустите приложение

```bash
npm run dev
```

## Шаг 4: Протестируйте оплату

1. Зарегистрируйтесь или войдите в систему
2. Перейдите в Профиль
3. Прокрутите вниз до раздела "Доступные тарифы"
4. Нажмите "Выбрать Plus" или "Выбрать Pro"
5. В модальном окне нажмите кнопку оплаты
6. Используйте тестовую карту:
   - Номер: `4300 0000 0000 0777`
   - Срок: `12/25`
   - CVV: `123`
   - 3-D Secure код: `12345678`

## Что должно произойти

1. ✅ Откроется модальное окно с тарифами
2. ✅ При клике на кнопку покажется индикатор загрузки
3. ✅ Произойдёт редирект на форму оплаты Т-Банк
4. ✅ После успешной оплаты откроется страница `/payment/success`
5. ✅ Подписка автоматически активируется
6. ✅ Баланс обновится

## Проверка результата

После успешной оплаты:
- В профиле должна отобразиться активная подписка
- Баланс проверок должен обновиться (450 для Plus, 900 для Pro)

## Возможные проблемы

### Кнопка не реагирует на клик
- Откройте консоль браузера (F12)
- Проверьте ошибки
- Убедитесь, что выполнены миграции

### Цены не отображаются
- Проверьте, что в БД есть планы: `SELECT * FROM subscription_plans`
- Убедитесь, что API `/api/subscription/plans` работает

### Ошибка при инициализации платежа
- Проверьте переменные окружения в `.env.local`
- Проверьте логи в консоли сервера
- Убедитесь, что таблица `payment_orders` создана

## Дополнительная информация

Полная инструкция по настройке: `PAYMENT_SETUP.md`

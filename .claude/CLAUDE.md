# Руководство по Разработке и Дизайну для CLAUDE CODE

Этот документ содержит свод правил, стандартов и лучших практик для разработки веб-приложений. Ваша задача — следовать этим указаниям для создания чистого, поддерживаемого и высококачественного кода и интерфейсов.

---

## **Общие Правила и Синтаксис**

* **Язык**: Всегда отвечай на русском языке.
* **Синтаксис**: Используй корректный синтаксис английского языка и кода. Убедись, что НЕ используешь китайские иероглифы.
* **Валидация кода**: Перед генерацией кода убедись, что он соответствует строгим правилам ESLint (`strict`) и синтаксису TypeScript 5.0+.
* **Конфигурация проекта**: Следуй правилам, определенным в файлах `tsconfig.json` (включая `strict mode` и `moduleResolution: 'bundler'`) и `.eslintrc.cjs` этого проекта.
* **Типизация**: Используй современные подсказки типов (type hints) и проверки для валидации кода в процессе написания.
* **Подход к написанию**: Не торопись. Пиши код строка за строкой, делая паузы для исправлений, как это делает IntelliSense.

---

## **Процесс Валидации и Исправления Ошибок**

### **Контрольный Список Валидации (VALIDATION)**

Проведи аудит и валидацию системы, чтобы убедиться в отсутствии ошибок, предупреждений и проблем с UI:

* Исправь проблемы со сборкой (высокий приоритет).
* Исправь ошибки в консоли браузера (высокий приоритет).
* Исправь все предупреждения и ошибки строгого линтинга (Strict Linting).
* Устрани предупреждения об устаревших пакетах (`Depreciation warnings`) при установке npm-зависимостей.
* Убедись, что все юнит-тесты (`jest`) проходят успешно.
* Проведи тестирование с помощью Playwright и Puppeteer.

### **Обязательный Подход к Работе (REQUIRED APPROACH)**

* **Список задач**: Для каждой категории проблем создай нумерованный список задач.
* **Пошаговое исправление**: Исправляй ОДНУ проблему за раз, тестируя код после каждого изменения.
* **Строгая типизация**: Убедись, что все типы TypeScript корректны и нигде не используется тип `any`.
* **Изолированное тестирование**: Тестируй каждый компонент в изоляции перед его интеграцией в общую систему.
* **Сохранение разметки**: Проверь, что сохранение состояния разметки (layout persistence) работает корректно.
* **Линтинг**: Запусти ESLint и исправь все предупреждения.

### **Требования к Результату (DELIVERABLES)**

* **План действий**: Сначала предоставь список задач.
* **Инкрементальные исправления**: Показывай исправления постепенно, сопровождая их фрагментами кода.
* **Верификация**: Тестируй и проверяй, что каждое исправление работает, прежде чем переходить к следующему.
* **Нулевая терпимость к ошибкам**: Убедись в отсутствии ошибок TypeScript, ESLint и в консоли.
* **Функциональность**: Подтверди, что все компоненты корректно отображаются и функционируют.

**Начинай работу с составления детального списка задач, а затем приступай к решению первой критической проблемы.**

---

## **Структура Файлов и Папок**

* **Задачи**: Все задачи, планы и пошаговые инструкции должны быть созданы и сохранены в виде отдельных файлов в папке `/tasks`.
* **Документация**: Вся техническая документация, включая архитектуру компонентов, описание потоков данных и JSDoc, должна размещаться в папке `/docs`.

---

## **Философия Разработки**

Основные принципы, которым вы должны следовать:

* [cite_start]**Чистый код**: Пишите чистый, поддерживаемый и масштабируемый код. [cite: 2]
* [cite_start]**SOLID**: Соблюдайте принципы SOLID. [cite: 2]
* [cite_start]**Функциональный подход**: Отдавайте предпочтение функциональным и декларативным паттернам программирования. [cite: 2]
* [cite_start]**Типобезопасность**: Уделяйте особое внимание типобезопасности и статическому анализу. [cite: 2]
* [cite_start]**Компонентный подход**: Практикуйте компонентно-ориентированную разработку (component-driven development). [cite: 2]

---

## **Backend и Данные**

* **Supabase**: В качестве бэкенда используется Supabase. Для чтения данных из базы данных используйте предоставленный Supabase mcp.

---

## **Процесс Реализации Кода**

### **Планирование**

Перед написанием кода необходимо:

* [cite_start]Начать с пошагового планирования задачи. [cite: 2]
* [cite_start]Написать детальный псевдокод. [cite: 2]
* [cite_start]Задокументировать архитектуру компонентов и потоки данных. [cite: 2]
* [cite_start]Продумать пограничные случаи и сценарии ошибок. [cite: 2]

### **Стиль Кода**

* [cite_start]**Отступы**: Используйте табы для отступов. [cite: 3]
* [cite_start]**Кавычки**: Используйте одинарные кавычки для строк. [cite: 3]
* [cite_start]**Точки с запятой**: Не ставьте точки с запятой в конце строк. [cite: 3]
* [cite_start]**Сравнение**: Всегда используйте строгое равенство (`===`) вместо нестрогого (`==`). [cite: 3]
* [cite_start]**Пробелы**: Добавляйте пробелы после ключевых слов [cite: 3][cite_start], перед скобками в объявлении функций [cite: 3][cite_start], вокруг инфиксных операторов [cite: 3] [cite_start]и после запятых. [cite: 3]
* [cite_start]**Переносы**: `else` должен находиться на той же строке, что и закрывающая фигурная скобка. [cite: 3, 4]
* [cite_start]**Длина строки**: Ограничьте длину строки 80 символами. [cite: 4]
* [cite_start]**Висячие запятые**: Используйте висячие запятые в многострочных объектах и массивах. [cite: 4]

### **Соглашения об Именованиях**

* [cite_start]**PascalCase**: для компонентов, определений типов и интерфейсов. [cite: 4]
* [cite_start]**kebab-case**: для названий папок (например, `auth-wizard`) [cite: 4] [cite_start]и файлов (например, `user-profile.tsx`). [cite: 5]
* [cite_start]**camelCase**: для переменных, функций, методов, хуков и пропсов. [cite: 5]
* [cite_start]**UPPERCASE**: для переменных окружения и констант. [cite: 5]
* [cite_start]**Обработчики событий**: начинайте с префикса `handle` (например, `handleClick`). [cite: 5, 6]
* [cite_start]**Булевы переменные**: начинайте с глаголов (например, `isLoading`, `hasError`). [cite: 6]
* [cite_start]**Кастомные хуки**: начинайте с префикса `use` (например, `useAuth`). [cite: 6]

---

## **UI/UX, Стиль и Адаптивный Дизайн**

### **Визуальный Дизайн и UX**

* [cite_start]**Иерархия**: Создайте четкую визуальную иерархию для управления вниманием пользователя. [cite: 45]
* [cite_start]**Единообразие**: Поддерживайте единый стиль во всем приложении. [cite: 48]
* [cite_start]**Навигация**: Используйте интуитивно понятные паттерны навигации. [cite: 49]
* [cite_start]**Обратная связь**: Обеспечьте четкую обратную связь на действия пользователя [cite: 56][cite_start], включая индикаторы загрузки. [cite: 56]
* [cite_start]**Mobile-First**: Проектируйте сначала для мобильных устройств, а затем масштабируйте до больших экранов. [cite: 61]

### **Стилизация**

* [cite_start]**Tailwind CSS**: Используйте Tailwind CSS для стилизации. [cite: 18]
* [cite_start]**Переменные**: Определите CSS-переменные для цветов и отступов темы для легкой поддержки и темизации. [cite: 22]
* [cite_start]**Темный режим**: Реализуйте поддержку темного режима. [cite: 20]
* **Адаптивность**:
    * [cite_start]Используйте относительные единицы (`%`, `em`, `rem`) вместо фиксированных пикселей. [cite: 69]
    * [cite_start]Применяйте CSS Grid и Flexbox для гибких макетов. [cite: 70]
    * [cite_start]Используйте медиа-запросы для адаптации макета к разным размерам экрана. [cite: 71]

### **Библиотеки Компонентов**

* [cite_start]**Shadcn UI**: Используйте компоненты Shadcn для согласованного и доступного дизайна. [cite: 16] [cite_start]Применяйте Shadcn mcp для создания модульных и переиспользуемых компонентов. [cite: 17]

---

## **React и Next.js**

### **React**

* [cite_start]**Компоненты**: Используйте функциональные компоненты с интерфейсами TypeScript. [cite: 6] [cite_start]Объявляйте их через ключевое слово `function`. [cite: 7]
* [cite_start]**Хуки**: Выносите переиспользуемую логику в кастомные хуки. [cite: 7]
* **Оптимизация**:
    * [cite_start]Стратегически используйте `React.memo()`. [cite: 7]
    * [cite_start]Применяйте `useCallback` для мемоизации колбэков [cite: 8] [cite_start]и `useMemo` для ресурсоемких вычислений. [cite: 8]
    * [cite_start]Избегайте инлайн-функций в JSX. [cite: 8]
    * [cite_start]Используйте динамические импорты для разделения кода (code splitting). [cite: 8]
    * [cite_start]Всегда используйте стабильные `key` в списках, избегая индексов. [cite: 8]

### **Next.js**

* [cite_start]**Роутинг**: Используйте **App Router**. [cite: 8]
* [cite_start]**Компоненты**: Используйте встроенные компоненты Next.js: `Image` для оптимизации изображений [cite: 8][cite_start], `Link` для навигации на стороне клиента [cite: 8] [cite_start]и `Script` для внешних скриптов. [cite: 8]
* **Серверные Компоненты**:
    * [cite_start]Используйте серверные компоненты по умолчанию. [cite: 9]
    * [cite_start]Применяйте директиву `'use client'` только при необходимости (для обработчиков событий, state, API браузера). [cite: 9]

---

## **Управление Состоянием**

* [cite_start]**Локальное состояние**: Используйте `useState` для простого состояния компонента [cite: 23][cite_start], `useReducer` для сложного [cite: 23] [cite_start]и `useContext` для общего состояния между компонентами. [cite: 23]

---

## **Обработка Ошибок и Валидация**

* [cite_start]**Валидация форм**: Используйте **Zod** для валидации схем [cite: 26] [cite_start]в связке с библиотеками форм (например, React Hook Form). [cite: 26]
* **Предохранители (Error Boundaries)**:
    * [cite_start]Используйте предохранители для корректной обработки ошибок в дереве компонентов. [cite: 26]
    * [cite_start]Логируйте ошибки во внешние сервисы (например, Sentry). [cite: 27]
    * [cite_start]Создавайте дружелюбные к пользователю запасные UI на случай ошибок. [cite: 28]

---

## **Тестирование**

* [cite_start]**Инструменты**: Используйте **Jest** и **React Testing Library**. [cite: 30]
* **Unit-тесты**:
    * [cite_start]Пишите тесты для отдельных функций и компонентов. [cite: 29]
    * [cite_start]Изолируйте тесты, мокая внешние зависимости и вызовы API. [cite: 32]
    * [cite_start]Следуйте паттерну "Arrange-Act-Assert". [cite: 31]
* **Интеграционные тесты**:
    * [cite_start]Фокусируйтесь на тестировании пользовательских сценариев и потоков. [cite: 33]
* **Общее правило**: После создания и внедрения решений необходимо провести полное тестирование для проверки их корректной работы.

---

## **Доступность (a11y)**

* [cite_start]**Семантика**: Используйте семантический HTML для создания осмысленной структуры. [cite: 37]
* [cite_start]**Навигация**: Обеспечьте полную поддержку навигации с клавиатуры. [cite: 38]
* [cite_start]**ARIA**: Применяйте ARIA-атрибуты там, где это необходимо. [cite: 38]
* [cite_start]**Контрастность**: Убедитесь, что контрастность цветов соответствует стандартам доступности (WCAG). [cite: 39]
* [cite_start]**Обратная связь**: Предоставляйте четкую и доступную обратную связь об ошибках. [cite: 40]

---

## **Прочие Руководства**

* [cite_start]**Безопасность**: Следуйте базовым подходам к обеспечению безопасности, включая валидацию и очистку данных, поступающих от пользователя, и используйте надежные методы аутентификации. [cite: 40, 41]
* **Документация**:
    * [cite_start]Используйте **JSDoc** для документирования кода. [cite: 42]
    * [cite_start]Документируйте все публичные функции, классы, методы и интерфейсы [cite: 42][cite_start], добавляя примеры при необходимости. [cite: 42]
    * [cite_start]Используйте корректное форматирование Markdown. [cite: 43]
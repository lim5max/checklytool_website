# План реализации системы авторизации для ChecklyTool

## Обзор проекта
Текущий проект - лендинг сайт на Next.js 15.5.0 с Tailwind CSS, Framer Motion и модальным окном для waitlist. Нужно добавить полноценную систему авторизации с сохранением существующего лендинга.

## Цели
1. Переименовать кнопку "Попробовать" на "Авторизация"
2. Создать страницы входа, регистрации и сброса пароля
3. Реализовать авторизацию через email/пароль
4. Добавить OAuth провайдеры (VK, Яндекс, Google)
5. Интегрировать Supabase для backend
6. Создать защищенный дашборд

## Технический стек
- **Frontend**: Next.js 15.5.0, React 19.1.0, TypeScript
- **Styling**: Tailwind CSS, Framer Motion для анимаций
- **UI**: shadcn/ui компоненты
- **Backend**: Supabase (Auth, Database)
- **OAuth**: VK, Яндекс, Google
- **Validation**: Zod

## Архитектурные изменения
- Минимальные изменения в существующий лендинг
- Добавление новых страниц в app router
- Создание middleware для защиты маршрутов
- Добавление AuthProvider для управления состоянием

## Детальный план выполнения

### Этап 1: Подготовка и настройка среды
#### Задача 1.1: Установка и настройка зависимостей
- [ ] Установить @supabase/auth-helpers-nextjs
- [ ] Установить @supabase/supabase-js  
- [ ] Установить zod для валидации форм
- [ ] Установить react-hook-form
- [ ] Установить shadcn/ui компоненты (form, input, button, card)

#### Задача 1.2: Настройка Supabase
- [ ] Создать проект в Supabase (если не создан)
- [ ] Настроить таблицы пользователей
- [ ] Настроить OAuth провайдеры (VK, Яндекс, Google)
- [ ] Настроить redirect URLs
- [ ] Добавить переменные окружения в .env.local

#### Задача 1.3: Создание базовой структуры
- [ ] Создать типы TypeScript для пользователей
- [ ] Создать утилиты для Supabase клиента
- [ ] Создать AuthProvider компонент
- [ ] Создать middleware для защиты маршрутов

### Этап 2: Обновление лендинга
#### Задача 2.1: Изменение навигации
- [ ] Переименовать кнопку "Попробовать" на "Войти" в хедере
- [ ] Переименовать кнопку в мобильной навигации
- [ ] Обновить все CTA кнопки на лендинге
- [ ] Изменить модальное окно на перенаправление

#### Задача 2.2: Обновление маршрутизации
- [ ] Изменить onClick handlers для кнопок
- [ ] Добавить роутинг на страницу авторизации
- [ ] Сохранить функциональность waitlist

### Этап 3: Создание страниц авторизации
#### Задача 3.1: Страница входа (/auth/login)
- [ ] Создать layout для auth страниц
- [ ] Создать компонент формы входа
- [ ] Добавить валидацию с Zod
- [ ] Интегрировать с Supabase Auth
- [ ] Добавить обработку ошибок
- [ ] Добавить анимации с Framer Motion

#### Задача 3.2: Страница регистрации (/auth/register)
- [ ] Создать компонент формы регистрации
- [ ] Добавить подтверждение пароля
- [ ] Интегрировать с Supabase Auth
- [ ] Добавить обработку ошибок
- [ ] Добавить анимации переходов

#### Задача 3.3: Страница сброса пароля (/auth/reset-password)
- [ ] Создать форму запроса сброса
- [ ] Создать страницу обновления пароля
- [ ] Интегрировать с Supabase Auth
- [ ] Добавить обработку состояний

### Этап 4: OAuth интеграция
#### Задача 4.1: Настройка провайдеров
- [ ] Настроить VK OAuth в Supabase
- [ ] Настроить Яндекс OAuth в Supabase  
- [ ] Настроить Google OAuth в Supabase
- [ ] Создать компоненты OAuth кнопок

#### Задача 4.2: Обработка OAuth callback
- [ ] Создать страницу auth/callback
- [ ] Обработать успешную авторизацию
- [ ] Обработать ошибки OAuth
- [ ] Добавить редиректы после авторизации

### Этап 5: Создание дашборда
#### Задача 5.1: Базовый дашборд
- [ ] Создать layout дашборда
- [ ] Добавить навигацию дашборда
- [ ] Создать профиль пользователя
- [ ] Добавить функцию выхода

#### Задача 5.2: Защита маршрутов
- [ ] Настроить middleware для защиты /dashboard
- [ ] Добавить редиректы для неавторизованных
- [ ] Создать loading states
- [ ] Обработать состояния авторизации

### Этап 6: UI/UX компоненты
#### Задача 6.1: Shadcn компоненты
- [ ] Настроить shadcn/ui конфигурацию
- [ ] Создать форм компоненты
- [ ] Создать кнопки и инпуты
- [ ] Создать карточки и модальные окна

#### Задача 6.2: Анимации и переходы
- [ ] Добавить page transitions с Framer Motion
- [ ] Создать loading анимации
- [ ] Добавить micro-interactions
- [ ] Оптимизировать UX переходов

### Этап 7: Тестирование и валидация
#### Задача 7.1: Функциональное тестирование
- [ ] Проверить все формы авторизации
- [ ] Протестировать OAuth провайдеры
- [ ] Проверить защиту маршрутов
- [ ] Валидировать user experience

#### Задача 7.2: Интеграционное тестирование
- [ ] Проверить Supabase интеграцию
- [ ] Протестировать email подтверждения
- [ ] Проверить сброс паролей
- [ ] Валидировать session management

### Этап 8: Оптимизация и финализация
#### Задача 8.1: Производительность
- [ ] Оптимизировать загрузку компонентов
- [ ] Добавить lazy loading где нужно
- [ ] Минимизировать bundle size
- [ ] Оптимизировать Core Web Vitals

#### Задача 8.2: Безопасность и accessibility
- [ ] Проверить WCAG соответствие
- [ ] Добавить proper focus management
- [ ] Валидировать keyboard navigation
- [ ] Проверить security best practices

## Необходимые файлы для создания

### Конфигурация
- `lib/supabase/client.ts` - Supabase клиент
- `lib/supabase/server.ts` - Server-side Supabase
- `types/auth.ts` - TypeScript типы
- `middleware.ts` - Route protection

### Страницы
- `app/auth/layout.tsx` - Layout для auth страниц
- `app/auth/login/page.tsx` - Страница входа
- `app/auth/register/page.tsx` - Страница регистрации
- `app/auth/reset-password/page.tsx` - Сброс пароля
- `app/auth/callback/page.tsx` - OAuth callback
- `app/dashboard/layout.tsx` - Layout дашборда
- `app/dashboard/page.tsx` - Главная дашборда

### Компоненты
- `components/auth/LoginForm.tsx` - Форма входа
- `components/auth/RegisterForm.tsx` - Форма регистрации
- `components/auth/OAuthButtons.tsx` - OAuth кнопки
- `components/auth/AuthProvider.tsx` - Auth context
- `components/dashboard/Navbar.tsx` - Навигация дашборда
- `components/ui/` - Shadcn компоненты

### Утилиты
- `lib/validations/auth.ts` - Zod schemas
- `lib/auth-helpers.ts` - Auth утилиты
- `hooks/useAuth.ts` - Auth hook

## Следующие шаги

После завершения авторизации, можно будет начать разработку основного функционала:
1. Загрузка и обработка работ школьников
2. ИИ проверка через OpenRouter
3. Система оценок и результатов
4. Управление классами и учениками
5. Аналитика и отчеты

## Зависимости от внешних сервисов

### Настройка Supabase:
1. Создать проект в Supabase
2. Настроить аутентификацию
3. Создать таблицы пользователей
4. Настроить OAuth провайдеры
5. Получить API ключи

### OAuth провайдеры:
1. **VK**: Создать приложение в VK Developers
2. **Яндекс**: Создать приложение в Яндекс.OAuth
3. **Google**: Настроить в Google Cloud Console

Этот план обеспечивает поэтапную реализацию с минимальными рисками для существующего лендинга.
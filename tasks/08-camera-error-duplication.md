# –ó–∞–¥–∞—á–∞ 8: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞–º–µ—Ä–æ–π –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ü—Ä–∏ –æ—à–∏–±–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–∞–º–µ—Ä–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–æ–≤
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∞—Ç—å –±–æ–ª—å—à–µ 1 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
–í `components/camera/CameraWorkInterface.tsx:246-280` —Ñ—É–Ω–∫—Ü–∏—è `capturePhoto` –∏–º–µ–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫, –Ω–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö.

```tsx
} catch (err) {
  // ... error handling

  // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É –µ—Å–ª–∏ –ø–æ—Ç–æ–∫ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω
  if (!streamRef.current?.active && isStreaming) {
    setTimeout(() => {
      stopCamera()
      setTimeout(() => startCamera(), 500)
    }, 100)
  }
}
```

## –ü—Ä–æ–±–ª–µ–º—ã
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–∏ –æ—à–∏–±–∫–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –Ω–æ–≤—ã–π —É—á–µ–Ω–∏–∫ –≤–º–µ—Å—Ç–æ retry
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã**: –ü–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –∫–∞–º–µ—Ä–∞ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏–µ

## –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `components/camera/CameraWorkInterface.tsx` (—Å—Ç—Ä–æ–∫–∏ 191-280, 64-89)
- –í–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ö—É–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π

## –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 8.1 –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—à–∏–±–æ–∫
```tsx
const capturePhoto = useCallback(async () => {
  if (isCapturing || !canAddMorePhotos) {
    console.log('[CAMERA] Capture blocked')
    return
  }

  setIsCapturing(true)

  try {
    // ... photo capture logic

    // Success - –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ
    addPhotoDraft(checkId, activeStudentIndex, dataUrl)
    toast.success('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Å–¥–µ–ª–∞–Ω–∞!')

  } catch (err) {
    console.error('[CAMERA] Capture failed:', err)
    toast.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.')

    // –ù–ï —Å–æ–∑–¥–∞–≤–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç —É—á–µ–Ω–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    // –¢–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

  } finally {
    setIsCapturing(false) // –í–ê–ñ–ù–û: –≤—Å–µ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
  }
}, [/* –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ */])
```

### 8.2 –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
```tsx
// –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –≤–æ –≤—Ä–µ–º—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏—è
<Button
  className={cn(
    "w-16 h-16 rounded-full transition-all duration-200",
    isCapturing
      ? "bg-green-500 scale-110 animate-pulse"
      : "bg-white hover:bg-gray-200"
  )}
  disabled={!isStreaming || isCapturing || !canAddMorePhotos}
  onClick={capturePhoto}
>
  {isCapturing ? (
    <div className="w-2 h-2 bg-white rounded-full" />
  ) : (
    <Camera className="w-8 h-8 text-black" />
  )}
</Button>

// –í—Å–ø—ã—à–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Ñ–æ—Ç–æ
{justCaptured && (
  <div className="absolute inset-0 bg-white animate-ping opacity-50 z-10" />
)}
```

### 8.3 –£–ª—É—á—à–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π
```tsx
const useCameraManager = () => {
  const [error, setError] = useState<string | null>(null)
  const [isStreaming, setIsStreaming] = useState(false)
  const [isCapturing, setIsCapturing] = useState(false)

  const recoverCamera = useCallback(async () => {
    try {
      await stopCamera()
      await new Promise(resolve => setTimeout(resolve, 500))
      await startCamera()
      setError(null)
    } catch (err) {
      setError('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–º–µ—Ä—É')
    }
  }, [])

  return { error, isStreaming, isCapturing, recoverCamera }
}
```

### 8.4 Prevent duplicate students
- –£–±—Ä–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É—á–µ–Ω–∏–∫–∞–º–∏

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
üü° –í–´–°–û–ö–ò–ô - –≤–ª–∏—è–µ—Ç –Ω–∞ core UX –∫–∞–º–µ—Ä—ã

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–∞–º–µ—Ä—ã –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —É—á–µ–Ω–∏–∫–æ–≤
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø—Ä–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ª–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º